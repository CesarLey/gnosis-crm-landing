<div class="checkout-container">
    <div class="checkout-card">
        <h2 class="title" *ngIf="!paymentSuccess">Confirmar Compra</h2>

        <!-- SUCCESS ANIMATION -->
        <div class="success-message" *ngIf="paymentSuccess">
            <div class="success-icon">ğŸ‰</div>
            <h3>Â¡Pago Completado!</h3>
            <p>Tu suscripciÃ³n ha sido activada correctamente.</p>
            <p>Enviamos los detalles a tu correo.</p>
            <a routerLink="/login" class="btn-primary">Ir a mi Panel &rarr;</a>
        </div>

        <div class="summary" *ngIf="!paymentSuccess">
            <div class="plan-details">
                <span class="plan-name">{{description}}</span>
                <span class="price">${{originalAmount}} MXN</span>
            </div>

            <!-- COUPON SECTION -->
            <div class="coupon-section">
                <input type="text" [(ngModel)]="couponCode" placeholder="Â¿Tienes un cÃ³digo de cupÃ³n?"
                    class="coupon-input" [disabled]="discountApplied">
                <button class="btn-apply" (click)="applyCoupon()" [disabled]="discountApplied || !couponCode">
                    {{ discountApplied ? 'Aplicado' : 'Aplicar' }}
                </button>
            </div>

            <div class="coupon-message" *ngIf="couponMessage"
                [ngClass]="{'text-success': discountApplied, 'text-danger': !discountApplied}">
                {{ couponMessage }}
            </div>

            <div class="discount-row" *ngIf="discountApplied">
                <span>Descuento aplicado:</span>
                <span>-${{discountAmount}} MXN</span>
            </div>

            <div class="total-row" [style.margin-top]="discountApplied ? '1rem' : '0'">
                <span>Total a Pagar:</span>
                <span class="total-price">${{amount}} MXN</span>
            </div>
        </div>

        <!-- MENSAJE DE ERROR -->
        <div class="alert alert-danger" *ngIf="paymentError">
            {{errorMessage}}
        </div>

        <!-- SELECTOR DE MÃ‰TODO DE PAGO -->
        <div class="payment-methods" *ngIf="!paymentSuccess">
            <p class="payment-label">Elige tu mÃ©todo de pago:</p>

            <!-- PAYPAL -->
            <div id="paypal-button-container" #paypalContainer></div>

            <!-- SEPARADOR -->
            <div class="separator">
                <span>o tambiÃ©n puedes pagar con</span>
            </div>

            <!-- OXXO / STRIPE BUTTON -->
            <button class="stripe-button" (click)="payWithStripe()" [disabled]="stripeLoading">
                <div class="stripe-button-content">
                    <div class="stripe-icons">
                        <span class="stripe-icon-item">ğŸ’³</span>
                        <span class="stripe-icon-item">ğŸª</span>
                    </div>
                    <div class="stripe-text">
                        <span class="stripe-main" *ngIf="!stripeLoading">Tarjeta Â· OXXO Â· SPEI</span>
                        <span class="stripe-main" *ngIf="stripeLoading">Redirigiendo a pago seguro...</span>
                        <span class="stripe-sub" *ngIf="!stripeLoading">Visa, Mastercard, AMEX, OXXO y mÃ¡s</span>
                    </div>
                </div>
                <span class="stripe-arrow" *ngIf="!stripeLoading">â†’</span>
                <div class="stripe-spinner" *ngIf="stripeLoading"></div>
            </button>

            <!-- FREE TRIAL LINK -->
            <div class="free-trial-container">
                <div class="separator"><span>Â¿AÃºn no estÃ¡s convencido?</span></div>
                <button class="btn-trial" (click)="startFreeTrial()" [disabled]="trialLoading">
                    <span *ngIf="!trialLoading">Iniciar Prueba Gratis de 7 DÃ­as</span>
                    <span *ngIf="trialLoading">Activando prueba...</span>
                </button>
            </div>
        </div>

        <div class="security-badges" *ngIf="!paymentSuccess">
            <i class="fas fa-lock"></i> Pago 100% Seguro Â· Cifrado SSL
        </div>
    </div>
</div>